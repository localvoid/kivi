<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Scheduler | kivi</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../advanced/03_components.html" />
    
    
    <link rel="prev" href="../advanced/01_element_descriptor.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="3.2"
        data-chapter-title="Scheduler"
        data-filepath="advanced/02_scheduler.md"
        data-basepath=".."
        data-revision="Wed Sep 07 2016 14:55:59 GMT+0700 (+07)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="01_getting_started.html">
            
                
                    <a href="../01_getting_started.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Getting Started
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> Basics</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="basics/01_components.html">
            
                
                    <a href="../basics/01_components.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Components
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="basics/02_virtual_dom.html">
            
                
                    <a href="../basics/02_virtual_dom.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Virtual DOM
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" >
            
            <span><b>3.</b> Advanced</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="advanced/01_element_descriptor.html">
            
                
                    <a href="../advanced/01_element_descriptor.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Element Descriptor
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.2" data-path="advanced/02_scheduler.html">
            
                
                    <a href="../advanced/02_scheduler.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Scheduler
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="advanced/03_components.html">
            
                
                    <a href="../advanced/03_components.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Components
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="advanced/04_virtual_dom.html">
            
                
                    <a href="../advanced/04_virtual_dom.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        Virtual DOM
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="advanced/05_events.html">
            
                
                    <a href="../advanced/05_events.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Events
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="advanced/06_reactive_bindings.html">
            
                
                    <a href="../advanced/06_reactive_bindings.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Reactive Bindings
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" >
            
            <span><b>4.</b> Experimental</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="experimental/01_incremental_rendering.html">
            
                
                    <a href="../experimental/01_incremental_rendering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Incremental Rendering
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >kivi</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="scheduler">Scheduler</h1>
<p>Kivi scheduler is responsible for executing frame tasks like updating components, reading from DOM, executing
microtasks and macrotasks.</p>
<h2 id="frame-tasks">Frame tasks</h2>
<p>Frame tasks will be executed in batches, starting with updating components sorted by their depth in components tree,
and then switching between read and write tasks until there are no tasks left.</p>
<p>There are two functions for accesing frame tasks: <code>currentFrame()</code> to get task group for the current frame, and
<code>nextFrame()</code> for the next frame.</p>
<p>Each frame task group provides different queues for components, DOM read and write tasks, and tasks that will be
executed after all other tasks are finished:</p>
<pre><code>currentFrame().updateComponent(c: Component&lt;any, any&gt;);
currentFrame().read(task: () =&gt; void);
currentFrame().write(task: () =&gt; void);
currentFrame().after(task: () =&gt; void);
</code></pre><h2 id="microtasks-and-macrotasks">Microtasks and Macrotasks</h2>
<p>Scheduler also provides interface for adding microtasks and macrotasks into browser event loop.</p>
<pre><code>scheduleMicrotask(cb: () =&gt; void)`
scheduleMacrotask(cb: () =&gt; void)`
</code></pre><h2 id="monotonically-increasing-clock">Monotonically increasing clock</h2>
<p>Each time scheduler finishes executing tasks from one of the queues, it increments internal clock. This clock can be
used to implement efficient checks in components to detect which input parameter has been changed since the last
update.</p>
<p>For example:</p>
<pre><code class="lang-ts"><span class="hljs-keyword">import</span> {clock} from <span class="hljs-string">&quot;kivi&quot;</span>;

<span class="hljs-keyword">class</span> Data {
  mtime: <span class="hljs-built_in">number</span>;
  value: <span class="hljs-built_in">number</span>;

  <span class="hljs-constructor"><span class="hljs-keyword">constructor</span>(value: number) </span>{
    <span class="hljs-keyword">this</span>.mtime = clock();
    <span class="hljs-keyword">this</span>.value = value;
  }

  setValue(newValue: <span class="hljs-built_in">number</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.value !== newValue) {
      <span class="hljs-keyword">this</span>.value = newValue;
      <span class="hljs-keyword">this</span>.mtime = clock();
    }
  }
}

<span class="hljs-keyword">const</span> MyComponent = <span class="hljs-keyword">new</span> ComponentDescriptor&lt;Data, <span class="hljs-built_in">any</span>&gt;()
  .newPropsReceived((c, oldProps, newProps) =&gt; {
    <span class="hljs-keyword">if</span> (c.mtime &lt; newProps.mtime) {
      c.markDirty();
    }
  });
</code></pre>
<p>Here we need to check if component&apos;s <code>mtime</code> property is older than <code>mtime</code> in a data object, and if it is older,
we are marking component as dirty. When component finishes update, it will automatically set its <code>mtime</code> to the current
<code>clock()</code> value.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../advanced/01_element_descriptor.html" class="navigation navigation-prev " aria-label="Previous page: Element Descriptor"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../advanced/03_components.html" class="navigation navigation-next " aria-label="Next page: Components"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-edit-link/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-github/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-anker-enable/anker.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"edit-link":{"base":"https://github.com/localvoid/kivi/tree/master/docs","label":"Edit This Page"},"github":{"url":"https://github.com/localvoid/kivi/"},"ga":{"token":"UA-39594570-5","configuration":"auto"},"anker-enable":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"all":["facebook","google","twitter","weibo","instapaper"],"facebook":true,"google":false,"instapaper":false,"twitter":true,"vk":false,"weibo":false},"fontsettings":{"family":"sans","size":2,"theme":"white"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
